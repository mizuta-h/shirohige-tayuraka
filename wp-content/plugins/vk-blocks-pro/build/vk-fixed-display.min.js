(()=>{function r(e,t){"undefined"!=typeof window&&window.sessionStorage&&window.sessionStorage.setItem(e,t)}function c(e){return"undefined"!=typeof window&&window.sessionStorage&&window.sessionStorage.getItem(e)}let d=new Map,t=!1;function u(e){return e.classList.contains("vk_fixed-display-mode-display-hide-after-time")?"display-hide-after-time":e.classList.contains("vk_fixed-display-mode-show-on-scroll")?"show-on-scroll":"always-visible"}function s(){document.querySelectorAll(".vk_fixed-display-close-button").forEach(e=>{let i=e.getAttribute("data-block-id");if(i){let t=e.closest(".vk_fixed-display"),s=t&&"true"===t.getAttribute("data-dont-show-again");s&&c("close_button_"+i)&&t&&t.classList.add("is-hidden-by-close-button"),e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),t&&(t.classList.add("is-hidden-by-close-button"),s)&&r("close_button_"+i,"true")})}})}function i(){let t=new MutationObserver(e=>{e.forEach(e=>{var t;"attributes"===e.type&&"data-dont-show-again"===e.attributeName&&(t=(e=e.target).getAttribute("data-block-id"),e=e.getAttribute("data-dont-show-again"),!t||!1!=("true"===e)&&"false"!==e||(e="dont_show_again_"+t,"undefined"!=typeof window&&window.sessionStorage&&window.sessionStorage.removeItem(e)))})});document.querySelectorAll(".vk_fixed-display").forEach(e=>{t.observe(e,{attributes:!0,attributeFilter:["data-dont-show-again"]})}),new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(e.classList&&e.classList.contains("vk_fixed-display")&&t.observe(e,{attributes:!0,attributeFilter:["data-dont-show-again"]}),e=e.querySelectorAll&&e.querySelectorAll(".vk_fixed-display"))&&e.forEach(e=>{t.observe(e,{attributes:!0,attributeFilter:["data-dont-show-again"]})})})})}).observe(document.body,{childList:!0,subtree:!0})}function a(){document.querySelectorAll(".vk_fixed-display-mode-show-on-scroll").forEach(e=>{let t=e.getAttribute("data-block-id");var s,i,a,o="true"===e.getAttribute("data-dont-show-again");o&&c("dont_show_again_"+t)?e.remove():(o&&!c("dont_show_again_"+t)&&e.classList.add("is-ready-to-show"),o=parseInt(e.getAttribute("data-scroll-timing"),10),i=e.getAttribute("data-scroll-timing-unit"),s="true"===e.getAttribute("data-persist-visible"),o=((e,t)=>{switch(t){case"px":return e;case"em":case"rem":return e*parseFloat(getComputedStyle(document.documentElement).fontSize);case"%":case"vh":case"svh":return e*window.innerHeight/100;default:return e}})(o,i),i=e.getAttribute("data-hide-after-seconds"),i=parseFloat(i)||0,d.has(t)||d.set(t,{wasHidden:!1}),a=d.get(t),window.scrollY>o&&!a.wasHidden?e.classList.contains("is-visible")||(e.classList.add("is-visible"),0<i&&!s&&setTimeout(()=>{e.classList.contains("is-visible")&&(e.classList.remove("is-visible"),d.set(t,{wasHidden:!0}))},1e3*i)):!s&&a.wasHidden||s||e.classList.contains("is-visible")&&e.classList.remove("is-visible"))})}function o(){document.querySelectorAll('[data-dont-show-again="true"]').forEach(e=>{var t=e.getAttribute("data-block-id");t&&(c("dont_show_again_"+t)?e.classList.add("is-hidden-by-session"):e.classList.add("is-ready-to-show"))})}function n(){var e,t;void 0!==window.vkBlocksFixedDisplayAjax&&0!==(e=(()=>{var t=[];if("undefined"!=typeof window&&window.sessionStorage)for(let e=0;e<window.sessionStorage.length;e++){var s=window.sessionStorage.key(e);s&&s.startsWith("dont_show_again_")&&t.push(s.replace("dont_show_again_",""))}return t})()).length&&((t=new FormData).append("action","vk_blocks_fixed_display_get_session"),t.append("block_ids",JSON.stringify(e)),t.append("nonce",window.vkBlocksFixedDisplayAjax.nonce),fetch(window.vkBlocksFixedDisplayAjax.ajaxurl,{method:"POST",body:t}))}function l(){document.querySelectorAll(".vk_fixed-display-mode-display-hide-after-time, .vk_fixed-display-mode-show-on-scroll, .vk_fixed-display-mode-always-visible").forEach(e=>{var t,s,i,a,o=e.getAttribute("data-block-id"),d="true"===e.getAttribute("data-dont-show-again"),n=e.getAttribute("data-display-after-seconds"),l=parseFloat(e.getAttribute("data-hide-after-seconds"))||0,n=null!==n?parseFloat(n):null;d&&c("dont_show_again_"+o)?e.classList.add("is-hidden-by-session"):(d&&!c("dont_show_again_"+o)&&e.classList.add("is-ready-to-show"),"show-on-scroll"!==u(e)&&(n=n,s=l,i=o,a=d,"display-hide-after-time"===(l=u(t=e))&&null!=n&&0<=n&&setTimeout(()=>{t.classList.contains("is-timed-visible")||(t.classList.add("is-timed-visible"),a&&r("dont_show_again_"+i,"true")),0<s&&setTimeout(()=>{t.classList.contains("is-timed-visible")&&(t.classList.remove("is-timed-visible"),t.classList.add("is-timed-hide"))},1e3*s)},1e3*n),"display-hide-after-time"===l)&&(null==n||n<0)&&0<s&&setTimeout(()=>{t.classList.add("is-timed-hide")},1e3*s))})}{o(),s(),"undefined"!=typeof window&&window.sessionStorage&&(t=!0);let e;window.addEventListener("scroll",()=>{e&&clearTimeout(e),e=setTimeout(a,16)}),window.addEventListener("DOMContentLoaded",()=>{t||(o(),s(),t=!0),l(),i(),n()}),window.addEventListener("load",()=>{t||(o(),s(),t=!0),l(),i(),n()})}})();