document.addEventListener("DOMContentLoaded",async()=>{let c=e=>"string"==typeof e&&/^[a-zA-Z0-9_-]+$/.test(e)?e:"",a=(e,t=[])=>{if(!e||"string"!=typeof e)return t;try{var n=JSON.parse(e);return Array.isArray(n)?n:t}catch(e){return t}},o=async()=>{try{var e=window.vkBlocksTocApi?.apiUrl||"/wp-json/vk-blocks/v1/toc_settings",t=await(await fetch(e,{credentials:"include"})).json();return t.success?t.data:null}catch(e){return null}},r=async()=>{let n=await o();n&&document.querySelectorAll(".wp-block-vk-blocks-table-of-contents-new").forEach(e=>{var t=e.querySelector(".vk_tableOfContents_list");if(t){let l;l="true"===e.dataset.useCustomLevels?a(e.dataset.customLevels||"[]",[]).map(e=>parseInt(e.replace("h","")))||[2,3,4,5,6]:n.allowedHeadingLevels||[2,3,4,5,6];let o=a(e.dataset.excludedHeadings||"[]",[]),r=!1!==n.includeBorderBox;t.querySelectorAll(".vk_tableOfContents_list_item").forEach(e=>{var t,n,a=e.className.match(/vk_tableOfContents_list_item-h-(\d+)/);a&&(a=parseInt(a[1]),n=e.querySelector("a"))&&(n=(n=n.getAttribute("href"))?n.replace("#",""):"",n=c(n),a=l.includes(a),t=o.includes(n),n=n.startsWith("vk-border-box-"),n=!r&&n,a&&!t&&!n||e.remove())})}})},s=(await r(),document.querySelectorAll(".vk_tableOfContents_list li").forEach(e=>{e.innerHTML=e.innerHTML.replace(/\uFFFC/g,"")}),document.querySelectorAll(".wp-block-vk-blocks-table-of-contents-new").forEach(t=>{let n=t.querySelector(".vk_tableOfContents_openCloseBtn");if(n){let e=n.previousElementSibling;t=n.closest(".tab").querySelector(".tab_content-open, .tab_content-close");t&&t.classList.contains("tab_content-open")?(n.textContent="CLOSE",e&&(e.checked=!0)):(n.textContent="OPEN",e&&(e.checked=!1)),n.addEventListener("click",function(){e&&"checkbox"===e.type&&setTimeout(()=>{n.textContent=e.checked?"CLOSE":"OPEN"},0)})}}),null),t=0,e=()=>{var e=Date.now();5e3<e-t&&(t=e,(async()=>{var e,t,n,a,l=await o();l&&s&&(e=JSON.stringify(l.allowedHeadingLevels),t=JSON.stringify(s.allowedHeadingLevels),n=l.includeBorderBox,a=s.includeBorderBox,e===t&&n===a||r()),s=l})())};document.addEventListener("visibilitychange",()=>{document.hidden||e()}),window.addEventListener("focus",e)});